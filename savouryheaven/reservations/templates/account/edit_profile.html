{% extends 'base.html' %}
{% load static %}

{% block title %}Edit Profile - Savory Heaven{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/edit_profile.css' %}">
<script src="{% static 'js/account/edit_profile.js' %}"></script>

<!-- Hero Section -->
<section class="profile-hero">
    <div class="container">
        <h1 class="page-title fade-in">Edit Profile</h1>
        <p class="page-subtitle fade-in-delay">Update your account information</p>
    </div>
</section>

<!-- Main Content -->
<section class="main-content">
    <div class="container">
        <a href="{% url 'my_reservations' %}" class="back-link fade-in">
            <i class="bi bi-arrow-left"></i>
            Back to My Reservations
        </a>

        <!-- Display Messages -->
        {% if messages %}
            <div class="fade-in">
                {% for message in messages %}
                    <div class="alert alert-{{ message.tags }}">
                        {{ message }}
                    </div>
                {% endfor %}
            </div>
        {% endif %}

        <div class="profile-forms fade-in-delay">
            <!-- Profile Information Form -->
            <div class="form-section">
                <h2 class="section-title">Profile Information</h2>
                <p class="section-description">Update your personal details and contact information.</p>
                
                <div class="current-info">
                    <h5>Current Information</h5>
                    <p><strong>Email:</strong> {{ user.email|default:"Not set" }}</p>
                    <p><strong>Name:</strong> {{ user.get_full_name|default:"Not set" }}</p>
                </div>

                <form method="post">
                    {% csrf_token %}
                    
                    <div class="form-group">
                        <label for="{{ profile_form.first_name.id_for_label }}" class="form-label">
                            First Name
                        </label>
                        {{ profile_form.first_name }}
                        {% if profile_form.first_name.help_text %}
                            <div class="help-text">{{ profile_form.first_name.help_text }}</div>
                        {% endif %}
                        {% if profile_form.first_name.errors %}
                            <ul class="error-list">
                                {% for error in profile_form.first_name.errors %}
                                    <li>{{ error }}</li>
                                {% endfor %}
                            </ul>
                        {% endif %}
                    </div>

                    <div class="form-group">
                        <label for="{{ profile_form.last_name.id_for_label }}" class="form-label">
                            Last Name
                        </label>
                        {{ profile_form.last_name }}
                        {% if profile_form.last_name.help_text %}
                            <div class="help-text">{{ profile_form.last_name.help_text }}</div>
                        {% endif %}
                        {% if profile_form.last_name.errors %}
                            <ul class="error-list">
                                {% for error in profile_form.last_name.errors %}
                                    <li>{{ error }}</li>
                                {% endfor %}
                            </ul>
                        {% endif %}
                    </div>

                    <div class="form-group">
                        <label for="{{ profile_form.email.id_for_label }}" class="form-label">
                            Email Address *
                        </label>
                        {{ profile_form.email }}
                        {% if profile_form.email.help_text %}
                            <div class="help-text">{{ profile_form.email.help_text }}</div>
                        {% endif %}
                        {% if profile_form.email.errors %}
                            <ul class="error-list">
                                {% for error in profile_form.email.errors %}
                                    <li>{{ error }}</li>
                                {% endfor %}
                            </ul>
                        {% endif %}
                    </div>

                    <button type="submit" name="update_profile" class="btn-submit">
                        <i class="bi bi-person-check me-2"></i>
                        Update Profile
                    </button>
                </form>
            </div>

            <!-- Password Change Form -->
            <div class="form-section">
                <h2 class="section-title">Change Password</h2>
                <p class="section-description">Update your account password for better security.</p>

                <form method="post">
                    {% csrf_token %}
                    
                    <div class="form-group">
                        <label for="{{ password_form.old_password.id_for_label }}" class="form-label">
                            Current Password
                        </label>
                        {{ password_form.old_password }}
                        {% if password_form.old_password.help_text %}
                            <div class="help-text">{{ password_form.old_password.help_text }}</div>
                        {% endif %}
                        {% if password_form.old_password.errors %}
                            <ul class="error-list">
                                {% for error in password_form.old_password.errors %}
                                    <li>{{ error }}</li>
                                {% endfor %}
                            </ul>
                        {% endif %}
                    </div>

                    <div class="form-group">
                        <label for="{{ password_form.new_password1.id_for_label }}" class="form-label">
                            New Password
                        </label>
                        {{ password_form.new_password1 }}
                        {% if password_form.new_password1.help_text %}
                            <div class="help-text">{{ password_form.new_password1.help_text }}</div>
                        {% endif %}
                        {% if password_form.new_password1.errors %}
                            <ul class="error-list">
                                {% for error in password_form.new_password1.errors %}
                                    <li>{{ error }}</li>
                                {% endfor %}
                            </ul>
                        {% endif %}
                    </div>

                    <div class="form-group">
                        <label for="{{ password_form.new_password2.id_for_label }}" class="form-label">
                            Confirm New Password
                        </label>
                        {{ password_form.new_password2 }}
                        {% if password_form.new_password2.help_text %}
                            <div class="help-text">{{ password_form.new_password2.help_text }}</div>
                        {% endif %}
                        {% if password_form.new_password2.errors %}
                            <ul class="error-list">
                                {% for error in password_form.new_password2.errors %}
                                    <li>{{ error }}</li>
                                {% endfor %}
                            </ul>
                        {% endif %}
                    </div>

                    <button type="submit" name="change_password" class="btn-submit">
                        <i class="bi bi-shield-check me-2"></i>
                        Change Password
                    </button>
                </form>
            </div>
        </div>
    </div>
</section>

{% endblock %}