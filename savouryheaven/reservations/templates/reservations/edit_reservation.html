{% extends 'base.html' %}
{% load static %}

{% block title %}Edit Reservation{% endblock %}

{% block content %}
<!-- CSS and JS imports -->
<link rel="stylesheet" href="{% static 'css/reservations/book.css' %}">
<script src="{% static 'js/reservations/edit_reservation.js' %}"></script>

<!-- ============================================= -->
<!-- HERO SECTION -->
<!-- ============================================= -->
<section class="booking-hero">
    <div class="booking-hero-content">
        <h1 class="display-4 fw-bold mb-3">Edit Your Reservation</h1>
        <p class="lead">Update your dining experience at Savory Heaven</p>
    </div>
</section>

<!-- ============================================= -->
<!-- MAIN EDITING FORM -->
<!-- ============================================= -->
<div class="booking-container">
    <div class="booking-card fade-in">
        <h2 class="section-title">Update Your Reservation</h2>
        
        <div class="info-box mb-4">
            <p class="mb-0">You are editing your reservation for <strong>{{ reservation.date }} at {{ reservation.time_slot.display_name }}</strong> originally made on {{ reservation.created_at|date:"F j, Y" }}.</p>
        </div>
        
        <form id="reservationForm" method="post" novalidate>
            {% csrf_token %}
            
            <!-- Personal info fields -->
            <div class="row">
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="id_name" class="form-label">Full Name *</label>
                        {{ form.name }}
                        {% if form.name.errors %}
                        <div class="field-error">{{ form.name.errors.0 }}</div>
                        {% endif %}
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="id_email" class="form-label">Email Address *</label>
                        {{ form.email }}
                        {% if form.email.errors %}
                        <div class="field-error">{{ form.email.errors.0 }}</div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Contact field -->
            <div class="form-group">
                <label for="id_phone" class="form-label">Phone Number *</label>
                {{ form.phone }}
                {% if form.phone.errors %}
                <div class="field-error">{{ form.phone.errors.0 }}</div>
                {% endif %}
            </div>

            <!-- ============================================= -->
            <!-- DATE/TIME SELECTION -->
            <!-- ============================================= -->
            <div class="form-group">
                <label for="id_date" class="form-label">Reservation Date *</label>
                <div class="date-picker-container">
                    {{ form.date }}
                    {% if form.date.errors %}
                    <div class="field-error">{{ form.date.errors.0 }}</div>
                    {% endif %}
                </div>
            </div>

            <!-- Time slot picker -->
            <div class="form-group">
                <label class="form-label">Select Time *</label>
                <div id="timeSlotsContainer" class="time-slots-container">
                    <div class="time-slot">Please select a date first</div>
                </div>
                <input type="hidden" id="id_time_slot" name="time_slot" value="{{ reservation.time_slot.id }}">
                {% if form.time_slot.errors %}
                <div class="field-error">{{ form.time_slot.errors.0 }}</div>
                {% endif %}
            </div>

            <!-- Party size selector -->
            <div class="form-group">
                <label class="form-label">Number of Guests *</label>
                <div class="guests-selector">
                    <button type="button" class="guests-btn" id="decreaseGuests">âˆ’</button>
                    <span class="guests-count" id="guestCount">{{ reservation.guests }}</span>
                    <button type="button" class="guests-btn" id="increaseGuests">+</button>
                </div>
                <input type="hidden" id="id_guests" name="guests" value="{{ reservation.guests }}">
                {% if form.guests.errors %}
                <div class="field-error">{{ form.guests.errors.0 }}</div>
                {% endif %}
            </div>

            <!-- Special requests textarea -->
            <div class="form-group">
                <label for="id_special_requests" class="form-label">Special Requests</label>
                {{ form.special_requests }}
            </div>

            <!-- System messages -->
            {% if messages %}
            <div class="messages">
                {% for message in messages %}
                <div class="alert alert-{{ message.tags }}">
                    {{ message }}
                </div>
                {% endfor %}
            </div>
            {% endif %}

            <!-- ============================================= -->
            <!-- FORM SUBMISSION -->
            <!-- ============================================= -->
            <button type="submit" class="submit-btn" id="submitBtn">
                <span id="submitText">Save Changes</span>
                <span id="loadingText" style="display: none;">Updating...</span>
            </button>

        </form>
        
        <div class="text-center mt-4">
            <p class="mb-0">Need to cancel instead? <a href="{% url 'cancel_reservation' reservation.id %}">Cancel this reservation</a></p>
        </div>
    </div>
    <!-- Form-wide errors -->
            {% if form.non_field_errors %}
                <div class="error-message">
                    {% for error in form.non_field_errors %}
                        <div>{{ error }}</div>
                    {% endfor %}
                </div>
            {% endif %}
</div>
{% endblock %}